---
layout: post
title: 直面错误
---

###错就是错，不要将错就错

程序中对错误的处理一定要谨慎，要正视自己的错误，不要写额外的代码去捕获并处理不该在运行时产生的错误。

例如，某个方法调用的时候明确要求需要一个 callback 函数作为参数，程序中就不要去把 callback 设置默认值，然后使用的时候又判断是不是传入了 callback 。
这样将多出很多无效的代码，这种只要运行一次，就能立刻发现的错误不应该捕获并做处理，画蛇添足，适得其反。

###不要带着错误继续运行

如果程序出现了严重的错误，应该立即停止，不要尝试继续运行，否则会扩大错误。

尤其是对类似 uncaughtException 的异常的全局捕获要更加的慎重，如果不能确定能够继续正常运行，一定要果断地崩溃掉，保护数据。

###谨慎对待异常处理抛出的异常

例如写入异常 log 文件的代码，要谨慎地对待可能发生的文件操作异常，对写入 log 时发生的异常要单独处理，不能再继续写入 log，否则将产生死循环。

如果将 log 写入数据库，一定要特别小心类似数据库连接失败这种异常，很可能导致死循环，将服务器资源耗光。

###异常分级

合理地对异常分级，并且使用不同的汇报方式有利于对异常的及时处理。

系统严重异常，例如：数据库连接失败，缓存服务失败导致无法命中，磁盘已满等应该立即发送邮件，短信等方式报警。

普通异常，例如：数据验证失败，404 页面等，应该使用次一级的方式汇报。
